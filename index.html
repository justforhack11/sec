<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>مراقبة جدول المذاكرة</title>
    <style>
        /* تحسين استيراد الخط Cairo بأوزان متعددة */
        @import url('https://fonts.googleapis.com/css2?family=Cairo:wght@300;400;500;600;700;800&display=swap');
        
        * {
            box-sizing: border-box;
            font-family: 'Cairo', sans-serif;
            margin: 0;
            padding: 0;
        }
        
        body {
            background-color: #f8f9fa;
            color: #333;
            line-height: 1.6;
            font-weight: 400;
            letter-spacing: 0.2px;
        }
        
        h1, h2, h3, h4, h5, h6 {
            font-weight: 700;
            letter-spacing: 0.5px;
        }
        
        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 25px;
        }
        
        header {
            background: linear-gradient(135deg, #4a6bff 0%, #2541b2 100%);
            color: white;
            text-align: center;
            padding: 30px;
            border-radius: 12px;
            margin-bottom: 30px;
            box-shadow: 0 6px 15px rgba(0, 0, 0, 0.15);
        }
        
        h1 {
            margin-bottom: 15px;
            font-size: 2.2rem;
            font-weight: 700;
            text-shadow: 0 2px 4px rgba(0, 0, 0, 0.2);
        }
        
        header p {
            font-size: 1.1rem;
            opacity: 0.9;
        }
        
        .timer-section {
            display: flex;
            justify-content: space-around;
            margin-bottom: 30px;
            gap: 20px;
        }
        
        .timer-box {
            background-color: white;
            border-radius: 12px;
            padding: 25px;
            text-align: center;
            width: 48%;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.08);
            transition: transform 0.3s, box-shadow 0.3s;
        }
        
        .timer-box:hover {
            transform: translateY(-5px);
            box-shadow: 0 8px 20px rgba(0, 0, 0, 0.12);
        }
        
        .timer-box h2 {
            color: #3f51b5;
            margin-bottom: 15px;
            font-size: 1.4rem;
            font-weight: 600;
        }
        
        .timer-display {
            font-size: 32px;
            font-weight: bold;
            color: #e91e63;
            margin: 15px 0;
            text-shadow: 0 1px 2px rgba(0, 0, 0, 0.1);
        }
        
        .date-display {
            font-size: 18px;
            margin-top: 10px;
            color: #666;
        }
        
        .tasks-grid {
            display: flex;
            flex-direction: column;
            gap: 25px;
            margin-bottom: 30px;
        }
        
        .day-card {
            background-color: white;
            border-radius: 12px;
            padding: 20px;
            transition: all 0.3s ease;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.08);
            position: relative;
            border-top: 5px solid #e0e0e0;
        }
        
        .day-card:hover {
            transform: translateY(-8px);
            box-shadow: 0 12px 20px rgba(0, 0, 0, 0.12);
        }
        
        .day-card.active {
            border-top: 5px solid #3f51b5;
        }
        
        .day-card.completed {
            border-top: 5px solid #4caf50;
            background-color: #f9fff9;
        }
        
        .day-card.missed {
            border-top: 5px solid #f44336;
            background-color: #fff9f9;
        }
        
        .day-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 15px;
            padding-bottom: 10px;
            border-bottom: 1px solid #eee;
        }
        
        .day-number {
            font-weight: bold;
            font-size: 22px;
            color: #3f51b5;
        }
        
        .day-status {
            font-size: 13px;
            padding: 5px 10px;
            border-radius: 20px;
            font-weight: 600;
            letter-spacing: 0.5px;
        }
        
        .day-status.active {
            background-color: #bbdefb;
            color: #1976d2;
        }
        
        .day-status.completed {
            background-color: #c8e6c9;
            color: #2e7d32;
        }
        
        .day-status.missed {
            background-color: #ffcdd2;
            color: #c62828;
        }
        
        .day-status.upcoming {
            background-color: #e0e0e0;
            color: #616161;
        }
        
        .task-list {
            margin-bottom: 15px;
        }
        
        .task-item {
            display: flex;
            align-items: center;
            margin-bottom: 12px;
            padding: 8px;
            border-radius: 8px;
            background-color: #f8f9fa;
        }
        
        .task-time {
            font-weight: bold;
            margin-left: 10px;
            min-width: 70px;
            color: #555;
        }
        
        .task-text {
            flex-grow: 1;
            padding: 0 10px;
        }
        
        .task-checkbox {
            margin-right: 5px;
            width: 20px;
            height: 20px;
            cursor: pointer;
            accent-color: #3f51b5;
        }
        
        .notes-area {
            width: 100%;
            resize: vertical;
            padding: 12px;
            border: 1px solid #ddd;
            border-radius: 8px;
            min-height: 80px;
            font-size: 14px;
            margin-top: 10px;
            transition: border 0.3s;
        }
        
        .notes-area:focus {
            outline: none;
            border-color: #3f51b5;
            box-shadow: 0 0 0 2px rgba(63, 81, 181, 0.2);
        }
        
        .day-selector {
            margin-bottom: 30px;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 15px;
        }
        
        .day-selector select {
            padding: 10px 20px;
            border-radius: 8px;
            border: 1px solid #ddd;
            background-color: white;
            font-size: 16px;
            cursor: pointer;
            box-shadow: 0 2px 5px rgba(0, 0, 0, 0.05);
            transition: all 0.3s;
        }
        
        .day-selector select:focus {
            outline: none;
            border-color: #3f51b5;
            box-shadow: 0 0 0 2px rgba(63, 81, 181, 0.2);
        }
        
        .day-selector button {
            padding: 10px 20px;
            border-radius: 8px;
            border: none;
            background: linear-gradient(135deg, #4a6bff 0%, #3f51b5 100%);
            color: white;
            cursor: pointer;
            transition: all 0.3s;
            font-weight: 600;
            box-shadow: 0 3px 6px rgba(0, 0, 0, 0.1);
        }
        
        .day-selector button:hover {
            background: linear-gradient(135deg, #3f51b5 0%, #303f9f 100%);
            box-shadow: 0 5px 10px rgba(0, 0, 0, 0.15);
            transform: translateY(-2px);
        }
        
        .day-selector button:active {
            transform: translateY(1px);
            box-shadow: 0 2px 5px rgba(0, 0, 0, 0.1);
        }
        
        .alert-banner {
            background: linear-gradient(135deg, #ff9a9e 0%, #f44336 100%);
            color: white;
            padding: 15px;
            border-radius: 8px;
            margin-bottom: 25px;
            font-weight: bold;
            text-align: center;
            display: none;
            box-shadow: 0 4px 10px rgba(244, 67, 54, 0.3);
            animation: pulse 2s infinite;
        }
        
        /* أنماط قسم التقدم */
        .progress-section {
            background-color: white;
            border-radius: 12px;
            padding: 25px;
            margin-bottom: 30px;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.08);
        }
        
        .progress-section h2 {
            color: #3f51b5;
            margin-bottom: 20px;
            text-align: center;
            font-size: 1.5rem;
        }
        
        .progress-container {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 20px;
        }
        
        .progress-item {
            margin-bottom: 15px;
        }
        
        .progress-label {
            font-weight: 600;
            margin-bottom: 8px;
            color: #555;
        }
        
        .progress-bar-container {
            height: 25px;
            background-color: #f0f0f0;
            border-radius: 20px;
            position: relative;
            overflow: hidden;
            box-shadow: inset 0 1px 3px rgba(0, 0, 0, 0.1);
        }
        
        .progress-bar {
            height: 100%;
            background: linear-gradient(135deg, #4a6bff 0%, #3f51b5 100%);
            border-radius: 20px;
            width: 0%;
            transition: width 1s ease-in-out;
        }
        
        .progress-percentage {
            position: absolute;
            right: 10px;
            top: 50%;
            transform: translateY(-50%);
            color: #333;
            font-weight: bold;
            text-shadow: 0 0 2px rgba(255, 255, 255, 0.7);
        }
        
        /* ألوان المواد */
        .math-color {
            background: linear-gradient(135deg, #4CAF50 0%, #2E7D32 100%);
        }
        
        .physics-color {
            background: linear-gradient(135deg, #2196F3 0%, #0D47A1 100%);
        }
        
        .chemistry-color {
            background: linear-gradient(135deg, #9C27B0 0%, #6A1B9A 100%);
        }
        
        .arabic-color {
            background: linear-gradient(135deg, #FF9800 0%, #E65100 100%);
        }
        
        .english-color {
            background: linear-gradient(135deg, #F44336 0%, #B71C1C 100%);
        }
        
        @keyframes pulse {
            0% { box-shadow: 0 4px 10px rgba(244, 67, 54, 0.3); }
            50% { box-shadow: 0 4px 20px rgba(244, 67, 54, 0.5); }
            100% { box-shadow: 0 4px 10px rgba(244, 67, 54, 0.3); }
        }
        
        @media (max-width: 768px) {
            .timer-section {
                flex-direction: column;
            }
            
            .timer-box {
                width: 100%;
                margin-bottom: 20px;
            }
            
            .tasks-grid {
                grid-template-columns: 1fr;
            }
            
            .day-selector {
                flex-wrap: wrap;
            }
            
            h1 {
                font-size: 1.8rem;
            }
            
            .progress-container {
                grid-template-columns: 1fr;
            }
        }
        
        /* أنماط قسم الإحصائيات */
        .stats-section {
            display: grid;
            grid-template-columns: repeat(4, 1fr);
            gap: 15px;
            margin-bottom: 30px;
        }
        
        .stats-box {
            background: white;
            border-radius: 12px;
            padding: 20px;
            text-align: center;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.08);
            transition: transform 0.3s, box-shadow 0.3s;
        }
        
        .stats-box:hover {
            transform: translateY(-5px);
            box-shadow: 0 8px 20px rgba(0, 0, 0, 0.12);
        }
        
        .stats-icon {
            font-size: 24px;
            margin-bottom: 10px;
        }
        
        .stats-value {
            font-size: 28px;
            font-weight: bold;
            color: #3f51b5;
            margin-bottom: 5px;
        }
        
        .stats-label {
            color: #666;
            font-size: 14px;
        }
        
        /* أنماط المهام حسب المادة */
        .task-item.math-task {
            border-right: 4px solid #4CAF50;
        }
        
        .task-item.physics-task {
            border-right: 4px solid #2196F3;
        }
        
        .task-item.chemistry-task {
            border-right: 4px solid #9C27B0;
        }
        
        .task-item.arabic-task {
            border-right: 4px solid #FF9800;
        }
        
        .task-item.english-task {
            border-right: 4px solid #F44336;
        }
        
        /* زر إعادة التعيين */
        .reset-button {
            background-color: #f44336;
            color: white;
            border: none;
            padding: 8px 15px;
            border-radius: 20px;
            cursor: pointer;
            font-size: 14px;
            margin-top: 15px;
            transition: all 0.3s;
        }
        
        .reset-button:hover {
            background-color: #d32f2f;
            box-shadow: 0 3px 8px rgba(0, 0, 0, 0.2);
        }
        
        /* زر تصدير الملاحظات */
        .export-button {
            background: linear-gradient(135deg, #4a6bff 0%, #3f51b5 100%);
            color: white;
            border: none;
            padding: 8px 15px;
            border-radius: 8px;
            cursor: pointer;
            font-size: 14px;
            margin-top: 10px;
            transition: all 0.3s;
            width: 100%;
        }
        
        .export-button:hover {
            background: linear-gradient(135deg, #3f51b5 0%, #303f9f 100%);
            box-shadow: 0 3px 8px rgba(0, 0, 0, 0.2);
        }
        
        /* تحسينات للهواتف المحمولة */
        @media (max-width: 768px) {
            .stats-section {
                grid-template-columns: repeat(2, 1fr);
            }
            
            /* ... existing code ... */
        }
    </style>
</head>
<body>
    <div class="container">
        <header>
            <h1>مراقبة جدول المذاكرة 60 يوم</h1>
            <p>تتبع تقدمك اليومي وحقق أهدافك</p>
            <button id="resetBtn" class="reset-button">إعادة تعيين البرنامج</button>
        </header>
        
        <div class="alert-banner" id="alertBanner"></div>
        
        <!-- إضافة قسم الإحصائيات -->
        <div class="stats-section">
            <div class="stats-box">
                <div class="stats-icon">📊</div>
                <div class="stats-value" id="completionRate">0%</div>
                <div class="stats-label">نسبة الإنجاز</div>
            </div>
            <div class="stats-box">
                <div class="stats-icon">✅</div>
                <div class="stats-value" id="completedTasks">0</div>
                <div class="stats-label">المهام المكتملة</div>
            </div>
            <div class="stats-box">
                <div class="stats-icon">⏱️</div>
                <div class="stats-value" id="streakDays">0</div>
                <div class="stats-label">أيام متتالية</div>
            </div>
            <div class="stats-box">
                <div class="stats-icon">🏆</div>
                <div class="stats-value" id="bestSubject">-</div>
                <div class="stats-label">المادة الأفضل</div>
            </div>
        </div>
        
        <div class="timer-section">
            <div class="timer-box">
                <h2>العد التنازلي الإجمالي</h2>
                <div class="timer-display" id="totalCountdown">60:00:00:00</div>
                <div class="date-display" id="startDate">تاريخ البداية: --/--/----</div>
            </div>
            
            <div class="timer-box">
                <h2>الوقت المتبقي في اليوم الحالي</h2>
                <div class="timer-display" id="dayCountdown">00:00:00</div>
                <div class="date-display" id="currentDate">اليوم: --/--/----</div>
            </div>
        </div>
        
        <div class="day-selector">
            <button id="prevDay">السابق</button>
            <select id="daySelect"></select>
            <button id="nextDay">التالي</button>
        </div>
        
        <div class="progress-section">
            <h2>مستوى التقدم</h2>
            <div class="progress-container">
                <div class="progress-item">
                    <div class="progress-label">التقدم العام</div>
                    <div class="progress-bar-container">
                        <div class="progress-bar" id="totalProgress"></div>
                        <span class="progress-percentage" id="totalProgressText">0%</span>
                    </div>
                </div>
                
                <div class="progress-item">
                    <div class="progress-label">رياضيات</div>
                    <div class="progress-bar-container">
                        <div class="progress-bar math-color" id="mathProgress"></div>
                        <span class="progress-percentage" id="mathProgressText">0%</span>
                    </div>
                </div>
                
                <div class="progress-item">
                    <div class="progress-label">فيزياء</div>
                    <div class="progress-bar-container">
                        <div class="progress-bar physics-color" id="physicsProgress"></div>
                        <span class="progress-percentage" id="physicsProgressText">0%</span>
                    </div>
                </div>
                
                <div class="progress-item">
                    <div class="progress-label">كيمياء</div>
                    <div class="progress-bar-container">
                        <div class="progress-bar chemistry-color" id="chemistryProgress"></div>
                        <span class="progress-percentage" id="chemistryProgressText">0%</span>
                    </div>
                </div>
                
                <div class="progress-item">
                    <div class="progress-label">عربي</div>
                    <div class="progress-bar-container">
                        <div class="progress-bar arabic-color" id="arabicProgress"></div>
                        <span class="progress-percentage" id="arabicProgressText">0%</span>
                    </div>
                </div>
                
                <div class="progress-item">
                    <div class="progress-label">إنجليزي</div>
                    <div class="progress-bar-container">
                        <div class="progress-bar english-color" id="englishProgress"></div>
                        <span class="progress-percentage" id="englishProgressText">0%</span>
                    </div>
                </div>
            </div>
        </div>
        
        <div class="tasks-grid" id="tasksGrid"></div>
    </div>
    
    <script>
// المتغيرات العامة
let programStartDate = null;
let currentSelectedDay = 1;
let userProgress = {
    currentDay: 1,
    tasks: {},
    streak: 0,
    lastCompletedDay: 0
};

// بيانات الجدول - قم بإضافة بياناتك هنا

// const scheduleData = [
//   {day: 1, morning: "إنجليزي (Unit 1)", evening: "فيزياء (باب 1 - جزء 1)"},
//   {day: 2, morning: "كيمياء (باب 1 - جزء 1)", evening: "رياضيات (وحدة 1 - جزء 1)"},
//   {day: 3, morning: "عربي (وحدة 1)", evening: "فيزياء (باب 1 - جزء 2)"},
//   {day: 4, morning: "إنجليزي (Unit 2)", evening: "رياضيات (وحدة 1 - جزء 2)"},
//   {day: 5, morning: "كيمياء (باب 1 - جزء 2)", evening: "عربي (وحدة 2)"},
//   {day: 6, morning: "إجازة", evening: "إجازة"},
//   {day: 7, morning: "رياضيات (وحدة 2 - جزء 1)", evening: "إنجليزي (Unit 3)"},
//   {day: 8, morning: "فيزياء (باب 2 - جزء 1)", evening: "عربي (وحدة 3)"},
//   {day: 9, morning: "كيمياء (باب 2 - جزء 1)", evening: "رياضيات (وحدة 2 - جزء 2)"},
//   {day: 10, morning: "إنجليزي (Unit 4)", evening: "فيزياء (باب 2 - جزء 2)"},
//   {day: 11, morning: "عربي (وحدة 4)", evening: "كيمياء (باب 2 - جزء 2)"},
//   {day: 12, morning: "إجازة", evening: "إجازة"},
//   {day: 13, morning: "رياضيات (وحدة 3 - جزء 1)", evening: "إنجليزي (Unit 5)"},
//   {day: 14, morning: "فيزياء (باب 3 - جزء 1)", evening: "عربي (وحدة 5)"},
//   {day: 15, morning: "كيمياء (باب 3 - جزء 1)", evening: "رياضيات (وحدة 3 - جزء 2)"},
//   {day: 16, morning: "إنجليزي (Unit 6)", evening: "فيزياء (باب 3 - جزء 2)"},
//   {day: 17, morning: "عربي (وحدة 6)", evening: "كيمياء (باب 3 - جزء 2)"},
//   {day: 18, morning: "إجازة", evening: "إجازة"},
//   {day: 19, morning: "رياضيات (وحدة 4 - جزء 1)", evening: "إنجليزي (Unit 7)"},
//   {day: 20, morning: "فيزياء (باب 4 - جزء 1)", evening: "عربي (وحدة 7)"},
//   {day: 21, morning: "كيمياء (باب 4 - جزء 1)", evening: "رياضيات (وحدة 4 - جزء 2)"},
//   {day: 22, morning: "إنجليزي (Unit 8)", evening: "فيزياء (باب 4 - جزء 2)"},
//   {day: 23, morning: "عربي (وحدة 8)", evening: "رياضيات (وحدة 5 - جزء 1)"},
//   {day: 24, morning: "إجازة", evening: "إجازة"},
//   {day: 25, morning: "كيمياء (باب 4 - جزء 2)", evening: "إنجليزي (Unit 9)"},
//   {day: 26, morning: "فيزياء (باب 5 - جزء 1)", evening: "رياضيات (وحدة 5 - جزء 2)"},
//   {day: 27, morning: "عربي (وحدة 9)", evening: "رياضيات (وحدة 6 - جزء 1)"},
//   {day: 28, morning: "إنجليزي (Unit 10)", evening: "فيزياء (باب 5 - جزء 2)"},
//   {day: 29, morning: "كيمياء (مراجعة) ", evening: "رياضيات (وحدة 6 - جزء 2)"},
//   {day: 30, morning: "إجازة", evening: "إجازة"},
//   {day: 31, morning: "عربي (مراجعة)", evening: "إنجليزي (مراجعة)"},
//   {day: 32, morning: "فيزياء (مراجعة)", evening: "رياضيات (مراجعة)"},
//   {day: 33, morning: "كيمياء (حل مسائل)", evening: "إنجليزي (تطبيقات)"},
//   {day: 34, morning: "رياضيات (حل مسائل)", evening: "عربي (تدريبات)"},
//   {day: 35, morning: "فيزياء (تدريبات)", evening: "كيمياء (حل امتحانات)"},
//   {day: 36, morning: "إجازة", evening: "إجازة"},
//   {day: 37, morning: "رياضيات (مراجعة شاملة)", evening: "فيزياء (تطبيقات)"},
//   {day: 38, morning: "إنجليزي (مراجعة عامة)", evening: "عربي (حل امتحانات)"},
//   {day: 39, morning: "كيمياء (تدريبات إضافية)", evening: "رياضيات (مراجعة مركزة)"},
//   {day: 40, morning: "إجازة", evening: "إجازة"},
//   {day: 41, morning: "فيزياء (مراجعة مركزة)", evening: "عربي (مراجعة مركزة)"},
//   {day: 42, morning: "رياضيات (حل مسائل إضافية)", evening: "إنجليزي (مراجعة سريعة)"},
//   {day: 43, morning: "كيمياء (حل مسائل إضافية)", evening: "عربي (مراجعة عامة)"},
//   {day: 44, morning: "فيزياء (حل امتحانات إضافية)", evening: "رياضيات (مراجعة مركزة)"},
//   {day: 45, morning: "إجازة", evening: "إجازة"},
//   {day: 46, morning: "كيمياء (حل امتحانات)", evening: "عربي (تطبيقات وتمارين)"},
//   {day: 47, morning: "فيزياء (حل مسائل)", evening: "إنجليزي (مراجعة سريعة)"},
//   {day: 48, morning: "رياضيات (تمارين مركزة)", evening: "كيمياء (مراجعة أخيرة)"},
//   {day: 49, morning: "إجازة", evening: "إجازة"},
//   {day: 50, morning: "استعداد للامتحان", evening: "راحة ذهنية"}
// ];


const scheduleData = [
  {day: 1, morning: "إنجليزي (Unit 1)", evening: "فيزياء (باب 1)"},
  {day: 2, morning: "كيمياء (باب 1 - جزء 1)", evening: "رياضيات (وحدة 1 - جزء 1)"},
  {day: 3, morning: "عربي (وحدة 1)", evening: "كيمياء (باب 1 - جزء 2)"},
  {day: 4, morning: "إنجليزي (Unit 2)", evening: "فيزياء (باب 2)"},
  {day: 5, morning: "رياضيات (وحدة 1 - جزء 2)", evening: null}, // يوم واحد فقط للرياضيات
  {day: 6, morning: "إجازة", evening: "إجازة"},
  {day: 7, morning: "كيمياء (باب 2 - جزء 1)", evening: "إنجليزي (Unit 3)"},
  {day: 8, morning: "فيزياء (باب 3)", evening: "عربي (وحدة 2)"},
  {day: 9, morning: "كيمياء (باب 2 - جزء 2)", evening: "رياضيات (وحدة 2 - جزء 1)"},
  {day: 10, morning: "إنجليزي (Unit 4)", evening: "فيزياء (باب 4)"},
  {day: 11, morning: "عربي (وحدة 3)", evening: null}, // يوم واحد فقط للعربي
  {day: 12, morning: "إجازة", evening: "إجازة"},
  {day: 13, morning: "رياضيات (وحدة 2 - جزء 2)", evening: "إنجليزي (Unit 5)"},
  {day: 14, morning: "فيزياء (باب 5)", evening: "كيمياء (باب 3 - جزء 1)"},
  {day: 15, morning: "كيمياء (باب 3 - جزء 2)", evening: "رياضيات (وحدة 3 - جزء 1)"},
  {day: 16, morning: "إنجليزي (Unit 6)", evening: "فيزياء (باب 6)"},
  {day: 17, morning: "عربي (وحدة 4)", evening: null}, // يوم واحد فقط للعربي
  {day: 18, morning: "إجازة", evening: "إجازة"},
  {day: 19, morning: "رياضيات (وحدة 3 - جزء 2)", evening: "إنجليزي (Unit 7)"},
  {day: 20, morning: "فيزياء (باب 7)", evening: "كيمياء (باب 4 - جزء 1)"},
  {day: 21, morning: "كيمياء (باب 4 - جزء 2)", evening: "عربي (وحدة 5)"},
  {day: 22, morning: "إنجليزي (Unit 8)", evening: "فيزياء (باب 8)"},
  {day: 23, morning: "رياضيات (وحدة 4 - جزء 1)", evening: null}, // يوم واحد فقط للرياضيات
  {day: 24, morning: "إجازة", evening: "إجازة"},
  {day: 25, morning: "كيمياء (باب 5 - جزء 1)", evening: "إنجليزي (Unit 9)"},
  {day: 26, morning: "فيزياء (باب 9)", evening: "عربي (وحدة 6)"},
  {day: 27, morning: "كيمياء (باب 5 - جزء 2)", evening: "رياضيات (وحدة 4 - جزء 2)"},
  {day: 28, morning: "إنجليزي (Unit 10)", evening: "فيزياء (باب 10)"},
  {day: 29, morning: "رياضيات (وحدة 5 - جزء 1)", evening: null}, // يوم واحد فقط للرياضيات
  {day: 30, morning: "إجازة", evening: "إجازة"},
  {day: 31, morning: "عربي (وحدة 7)", evening: "إنجليزي (Unit 11)"},
  {day: 32, morning: "فيزياء (باب 11)", evening: "كيمياء (باب 6 - جزء 1)"},
  {day: 33, morning: "كيمياء (باب 6 - جزء 2)", evening: "رياضيات (وحدة 5 - جزء 2)"},
  {day: 34, morning: "إنجليزي (Unit 12)", evening: "عربي (وحدة 8)"},
  {day: 35, morning: "رياضيات (وحدة 6 - جزء 1)", evening: null}, // يوم واحد فقط للرياضيات
  {day: 36, morning: "إجازة", evening: "إجازة"},
  {day: 37, morning: "كيمياء (باب 7 - جزء 1)", evening: "فيزياء (مراجعة أبواب 1-4)"},
  {day: 38, morning: "كيمياء (باب 7 - جزء 2)", evening: "عربي (وحدة 9)"},
  {day: 39, morning: "رياضيات (وحدة 6 - جزء 2)", evening: "إنجليزي (مراجعة Units 1-6)"},
  {day: 40, morning: "إجازة", evening: "إجازة"},
  {day: 41, morning: "فيزياء (مراجعة أبواب 5-8)", evening: "كيمياء (باب 8 - جزء 1)"},
  {day: 42, morning: "كيمياء (باب 8 - جزء 2)", evening: "رياضيات (مراجعة وحدات 1-3)"},
  {day: 43, morning: "إنجليزي (مراجعة Units 7-12)", evening: "عربي (مراجعة وحدات 1-5)"},
  {day: 44, morning: "فيزياء (مراجعة أبواب 9-11)", evening: "كيمياء (باب 9 - جزء 1)"},
  {day: 45, morning: "إجازة", evening: "إجازة"},
  {day: 46, morning: "كيمياء (باب 9 - جزء 2)", evening: "رياضيات (مراجعة وحدات 4-6)"},
  {day: 47, morning: "عربي (مراجعة وحدات 6-9)", evening: "كيمياء (باب 10 - جزء 1)"},
  {day: 48, morning: "كيمياء (باب 10 - جزء 2)", evening: "فيزياء (تدريبات وحل مسائل)"},
  {day: 49, morning: "كيمياء (باب 11 - جزء 1)", evening: "كيمياء (باب 11 - جزء 2)"},
  {day: 50, morning: "إنجليزي (مراجعة نهائية)", evening: "رياضيات (مراجعة نهائية)"},
  {day: 51, morning: "فيزياء (مراجعة نهائية)", evening: "كيمياء (مراجعة نهائية)"},
  {day: 52, morning: "عربي (مراجعة نهائية)", evening: "استعداد للامتحان"},
  {day: 53, morning: "مراجعة آخر يوم", evening: "راحة ذهنية"},

  {day: 54, morning: "إنجليزي (حل امتحانات سابقة)", evening: "رياضيات (حل امتحانات سابقة)"},
  {day: 55, morning: "فيزياء (حل مسائل صعبة)", evening: "كيمياء (حل مسائل صعبة)"},
  {day: 56, morning: "عربي (تدريبات مكثفة)", evening: "إنجليزي (تدريبات مكثفة)"},
  {day: 57, morning: "مراجعة شاملة للنقاط الصعبة في كل المواد", evening: "التركيز على الأجزاء الأكثر أهمية"},
  {day: 58, morning: "حل أسئلة نموذجية - الجزء الأول", evening: "حل أسئلة نموذجية - الجزء الثاني"},
  {day: 59, morning: "تلخيص القوانين والمعادلات الرئيسية", evening: "مراجعة المفاهيم الأساسية"},
  {day: 60, morning: "المراجعة الأخيرة لجميع المواد", evening: "الاسترخاء والاستعداد النفسي للامتحان"}
];

// تهيئة العناصر
document.addEventListener('DOMContentLoaded', function() {
    // تحميل البيانات من localStorage أو إنشاء جديدة
    loadUserProgress();
    
    // إنشاء قائمة الأيام في العنصر select
    populateDaySelect();
    
    // عرض بطاقات الأيام
    renderDayCards();
    
    // تحديث العدادات
    updateCountdowns();
    
    // تحديث أشرطة التقدم
    updateProgressBars();
    
    // تحديث كل ثانية
    setInterval(updateCountdowns, 1000);
    
    // إضافة مستمعي الأحداث
    document.getElementById('prevDay').addEventListener('click', () => {
        if (currentSelectedDay > 1) {
            currentSelectedDay--;
            document.getElementById('daySelect').value = currentSelectedDay;
            renderDayCards();
        }
    });
    
    document.getElementById('nextDay').addEventListener('click', () => {
        if (currentSelectedDay < 60) {
            currentSelectedDay++;
            document.getElementById('daySelect').value = currentSelectedDay;
            renderDayCards();
        }
    });
    
    document.getElementById('daySelect').addEventListener('change', (e) => {
        currentSelectedDay = parseInt(e.target.value);
        renderDayCards();
    });
    
    // فحص المهام الفائتة
    checkMissedTasks();
});

// تحميل بيانات المستخدم من localStorage
function loadUserProgress() {
    const savedProgress = localStorage.getItem('studyScheduleProgress');
    
    if (savedProgress) {
        userProgress = JSON.parse(savedProgress);
        programStartDate = new Date(userProgress.startDate);
        
        // إضافة خصائص جديدة إذا لم تكن موجودة (للتوافق مع التحديثات)
        if (!userProgress.hasOwnProperty('streak')) {
            userProgress.streak = 0;
        }
        if (!userProgress.hasOwnProperty('lastCompletedDay')) {
            userProgress.lastCompletedDay = 0;
        }
    } else {
        // إنشاء بيانات جديدة
        programStartDate = new Date();
        
        userProgress = {
            startDate: programStartDate.toISOString(),
            currentDay: calculateCurrentDay(programStartDate),
            tasks: {},
            streak: 0,
            lastCompletedDay: 0
        };
        
        // تهيئة مهام كل يوم
        for (let i = 1; i <= 60; i++) {
            const dayData = scheduleData.find(d => d.day === i) || { morning: 'غير محدد', evening: 'غير محدد' };
            
            userProgress.tasks[i] = {
                morningCompleted: false,
                eveningCompleted: false,
                notes: '',
                date: new Date(programStartDate.getTime() + ((i - 1) * 24 * 60 * 60 * 1000)).toISOString()
            };
        }
        
        saveUserProgress();
    }
    
    currentSelectedDay = userProgress.currentDay;
    
    // عرض تاريخ البداية
    document.getElementById('startDate').textContent = 'تاريخ البداية: ' + formatDate(new Date(userProgress.startDate));
    
    // تحديث أشرطة التقدم والإحصائيات
    updateProgressBars();
    updateStatistics();
    
    // إضافة مستمع لزر إعادة التعيين
    document.getElementById('resetBtn').addEventListener('click', resetProgram);
}

// حفظ بيانات المستخدم في localStorage
function saveUserProgress() {
    localStorage.setItem('studyScheduleProgress', JSON.stringify(userProgress));
    
    // تحديث الإحصائيات بعد كل حفظ
    updateStatistics();
}

// حساب اليوم الحالي بناءً على تاريخ البداية
function calculateCurrentDay(startDate) {
    const now = new Date();
    const diffTime = now - startDate;
    const diffDays = Math.floor(diffTime / (1000 * 60 * 60 * 24)) + 1;
    
    return Math.min(Math.max(diffDays, 1), 60);
}

// ملء قائمة الأيام في العنصر select
function populateDaySelect() {
    const select = document.getElementById('daySelect');
    
    for (let i = 1; i <= 60; i++) {
        const option = document.createElement('option');
        option.value = i;
        option.textContent = 'اليوم ' + i;
        select.appendChild(option);
    }
    
    select.value = currentSelectedDay;
}

// تحديث العدادات
function updateCountdowns() {
    const now = new Date();
    
    // تحديث التاريخ الحالي
    document.getElementById('currentDate').textContent = 'اليوم: ' + formatDate(now);
    
    // حساب العد التنازلي الإجمالي
    const startDate = new Date(userProgress.startDate);
    const endDate = new Date(startDate.getTime() + (60 * 24 * 60 * 60 * 1000));
    const totalRemaining = Math.max(0, endDate - now);
    
    document.getElementById('totalCountdown').textContent = formatCountdown(totalRemaining);
    
    // حساب الوقت المتبقي في اليوم الحالي
    const tomorrow = new Date(now);
    tomorrow.setHours(23, 59, 59, 999);
    const dayRemaining = tomorrow - now;
    
    document.getElementById('dayCountdown').textContent = formatCountdownDay(dayRemaining);
    
    // تحديث اليوم الحالي إذا تغير
    const calculatedDay = calculateCurrentDay(new Date(userProgress.startDate));
    if (calculatedDay !== userProgress.currentDay) {
        userProgress.currentDay = calculatedDay;
        saveUserProgress();
        
        // تحديث العرض إذا كان المستخدم يعرض اليوم الحالي
        if (currentSelectedDay === calculatedDay - 1) {
            currentSelectedDay = calculatedDay;
            document.getElementById('daySelect').value = currentSelectedDay;
            renderDayCards();
        }
    }
}

// تنسيق العد التنازلي 
function formatCountdown(timeInMs) {
    if (timeInMs <= 0) {
        return '00:00:00:00';
    }
    
    const days = Math.floor(timeInMs / (1000 * 60 * 60 * 24));
    const hours = Math.floor((timeInMs % (1000 * 60 * 60 * 24)) / (1000 * 60 * 60));
    const minutes = Math.floor((timeInMs % (1000 * 60 * 60)) / (1000 * 60));
    const seconds = Math.floor((timeInMs % (1000 * 60)) / 1000);
    
    return `${days.toString().padStart(2, '0')}:${hours.toString().padStart(2, '0')}:${minutes.toString().padStart(2, '0')}:${seconds.toString().padStart(2, '0')}`;
}

// تنسيق العد التنازلي لليوم
function formatCountdownDay(timeInMs) {
    if (timeInMs <= 0) {
        return '00:00:00';
    }
    
    const hours = Math.floor(timeInMs / (1000 * 60 * 60));
    const minutes = Math.floor((timeInMs % (1000 * 60 * 60)) / (1000 * 60));
    const seconds = Math.floor((timeInMs % (1000 * 60)) / 1000);
    
    return `${hours.toString().padStart(2, '0')}:${minutes.toString().padStart(2, '0')}:${seconds.toString().padStart(2, '0')}`;
}

// تنسيق التاريخ
function formatDate(date) {
    return `${date.getDate().toString().padStart(2, '0')}/${(date.getMonth() + 1).toString().padStart(2, '0')}/${date.getFullYear()}`;
}

// عرض بطاقات الأيام
function renderDayCards() {
    const grid = document.getElementById('tasksGrid');
    grid.innerHTML = '';
    
    // تحديد نطاق الأيام للعرض (اليوم الحالي ± 2 أيام)
    const startDay = Math.max(1, currentSelectedDay - 2);
    const endDay = Math.min(60, currentSelectedDay + 2);
    
    for (let i = startDay; i <= endDay; i++) {
        const dayData = scheduleData.find(d => d.day === i) || { morning: 'غير محدد', evening: 'غير محدد' };
        const progressData = userProgress.tasks[i] || {
            morningCompleted: false,
            eveningCompleted: false,
            notes: ''
        };
        
        const dayCard = document.createElement('div');
        dayCard.className = 'day-card';
        
        // تحديد حالة البطاقة
        const taskDate = new Date(progressData.date);
        const now = new Date();
        const isOverdue = taskDate < now && taskDate.getDate() !== now.getDate();
        
        if (i === userProgress.currentDay) {
            dayCard.classList.add('active');
        } else if (isOverdue && 
                  (!progressData.morningCompleted || !progressData.eveningCompleted) && 
                  (dayData.morning !== 'إجازة' || dayData.evening !== 'إجازة')) {
            dayCard.classList.add('missed');
        } else if (i < userProgress.currentDay && 
                  progressData.morningCompleted && progressData.eveningCompleted) {
            dayCard.classList.add('completed');
        }
        
        // رأس البطاقة
        const dayHeader = document.createElement('div');
        dayHeader.className = 'day-header';
        
        const dayNumber = document.createElement('div');
        dayNumber.className = 'day-number';
        dayNumber.textContent = 'اليوم ' + i;
        
        const dayStatus = document.createElement('div');
        dayStatus.className = 'day-status';
        
        if (i === userProgress.currentDay) {
            dayStatus.textContent = 'اليوم';
            dayStatus.classList.add('active');
        } else if (isOverdue && 
                  (!progressData.morningCompleted || !progressData.eveningCompleted) && 
                  (dayData.morning !== 'إجازة' || dayData.evening !== 'إجازة')) {
            dayStatus.textContent = 'فائت';
            dayStatus.classList.add('missed');
        } else if (i < userProgress.currentDay) {
            dayStatus.textContent = 'مكتمل';
            dayStatus.classList.add('completed');
        } else {
            dayStatus.textContent = 'قادم';
            dayStatus.classList.add('upcoming');
        }
        
        dayHeader.appendChild(dayNumber);
        dayHeader.appendChild(dayStatus);
        dayCard.appendChild(dayHeader);
        
        // تاريخ اليوم
        const dayDate = document.createElement('div');
        dayDate.className = 'date-display';
        dayDate.style.fontSize = '14px';
        dayDate.style.marginBottom = '10px';
        dayDate.style.color = isOverdue ? '#f44336' : '#666';
        dayDate.style.fontWeight = isOverdue ? 'bold' : 'normal';
        dayDate.textContent = formatDate(new Date(progressData.date));
        dayCard.appendChild(dayDate);
        
        // قائمة المهام
        const taskList = document.createElement('div');
        taskList.className = 'task-list';
        
        // مهمة الصباح
        const morningTask = document.createElement('div');
        morningTask.className = 'task-item';
        
        // إضافة تصنيف المادة للمهمة
        const subjectClass = getSubjectClass(dayData.morning);
        if (subjectClass) {
            morningTask.classList.add(subjectClass);
        }
        
        const morningTime = document.createElement('div');
        morningTime.className = 'task-time';
        morningTime.textContent = 'صباحاً:';
        
        const morningText = document.createElement('div');
        morningText.className = 'task-text';
        morningText.textContent = dayData.morning;
        
        const morningCheckbox = document.createElement('input');
        morningCheckbox.type = 'checkbox';
        morningCheckbox.className = 'task-checkbox';
        morningCheckbox.checked = progressData.morningCompleted;
        morningCheckbox.disabled = i > userProgress.currentDay;
        
        morningCheckbox.addEventListener('change', () => {
            userProgress.tasks[i].morningCompleted = morningCheckbox.checked;
            saveUserProgress();
            renderDayCards();
            updateProgressBars();
            updateStreak();
        });
        
        morningTask.appendChild(morningTime);
        morningTask.appendChild(morningText);
        morningTask.appendChild(morningCheckbox);
        taskList.appendChild(morningTask);
        
        // مهمة المساء
        const eveningTask = document.createElement('div');
        eveningTask.className = 'task-item';
        
        // إضافة تصنيف المادة للمهمة
        const eveningSubjectClass = getSubjectClass(dayData.evening);
        if (eveningSubjectClass) {
            eveningTask.classList.add(eveningSubjectClass);
        }
        
        const eveningTime = document.createElement('div');
        eveningTime.className = 'task-time';
        eveningTime.textContent = 'مساءً:';
        
        const eveningText = document.createElement('div');
        eveningText.className = 'task-text';
        eveningText.textContent = dayData.evening;
        
        const eveningCheckbox = document.createElement('input');
        eveningCheckbox.type = 'checkbox';
        eveningCheckbox.className = 'task-checkbox';
        eveningCheckbox.checked = progressData.eveningCompleted;
        eveningCheckbox.disabled = i > userProgress.currentDay;
        
        eveningCheckbox.addEventListener('change', () => {
            userProgress.tasks[i].eveningCompleted = eveningCheckbox.checked;
            saveUserProgress();
            renderDayCards();
            updateProgressBars();
            updateStreak();
        });
        
        eveningTask.appendChild(eveningTime);
        eveningTask.appendChild(eveningText);
        eveningTask.appendChild(eveningCheckbox);
        taskList.appendChild(eveningTask);
        
        dayCard.appendChild(taskList);
        
        // حقل الملاحظات
        const notesLabel = document.createElement('div');
        notesLabel.textContent = 'ملاحظات:';
        notesLabel.style.marginTop = '10px';
        notesLabel.style.marginBottom = '5px';
        notesLabel.style.fontWeight = 'bold';
        
        const notesArea = document.createElement('textarea');
        notesArea.className = 'notes-area';
        notesArea.value = progressData.notes || '';
        notesArea.placeholder = 'أضف ملاحظاتك هنا...';
        
        notesArea.addEventListener('change', () => {
            userProgress.tasks[i].notes = notesArea.value;
            saveUserProgress();
        });
        
        dayCard.appendChild(notesLabel);
        dayCard.appendChild(notesArea);
        
        // إضافة زر لتصدير الملاحظات
        if (progressData.notes && progressData.notes.trim() !== '') {
            const exportButton = document.createElement('button');
            exportButton.className = 'export-button';
            exportButton.textContent = 'تصدير الملاحظات';
            exportButton.addEventListener('click', () => {
                exportNotes(i, progressData.notes);
            });
            dayCard.appendChild(exportButton);
        }
        
        grid.appendChild(dayCard);
    }
}

// تحديد فئة المادة بناءً على النص
function getSubjectClass(taskText) {
    if (!taskText) return null;
    
    if (taskText.includes('رياضيات')) {
        return 'math-task';
    } else if (taskText.includes('فيزياء')) {
        return 'physics-task';
    } else if (taskText.includes('كيمياء')) {
        return 'chemistry-task';
    } else if (taskText.includes('عربي')) {
        return 'arabic-task';
    } else if (taskText.includes('إنجليزي')) {
        return 'english-task';
    }
    return null;
}

// تصدير الملاحظات كملف نصي
function exportNotes(day, notes) {
    const blob = new Blob([notes], { type: 'text/plain;charset=utf-8' });
    const url = URL.createObjectURL(blob);
    const a = document.createElement('a');
    a.href = url;
    a.download = `ملاحظات_اليوم_${day}.txt`;
    document.body.appendChild(a);
    a.click();
    document.body.removeChild(a);
    URL.revokeObjectURL(url);
}

// تحديث سلسلة الأيام المتتالية
function updateStreak() {
    const currentDay = userProgress.currentDay;
    
    // التحقق من اكتمال اليوم الحالي
    const todayData = userProgress.tasks[currentDay];
    const todaySchedule = scheduleData.find(d => d.day === currentDay) || { morning: 'غير محدد', evening: 'غير محدد' };
    
    const isTodayCompleted = 
        (todaySchedule.morning === 'إجازة' || todayData.morningCompleted) && 
        (todaySchedule.evening === 'إجازة' || todayData.eveningCompleted);
    
    // إذا كان اليوم الحالي مكتمل وهو اليوم التالي للسلسلة السابقة
    if (isTodayCompleted && userProgress.lastCompletedDay === currentDay - 1) {
        userProgress.streak++;
        userProgress.lastCompletedDay = currentDay;
    } 
    // إذا كان اليوم الحالي مكتمل ولكن السلسلة انقطعت
    else if (isTodayCompleted && userProgress.lastCompletedDay !== currentDay) {
        userProgress.streak = 1;
        userProgress.lastCompletedDay = currentDay;
    }
    
    saveUserProgress();
}

// تحديث الإحصائيات
function updateStatistics() {
    // حساب نسبة الإنجاز
    let totalTasks = 0;
    let completedTasks = 0;
    
    // حساب التقدم لكل مادة
    let subjects = {
        math: { total: 0, completed: 0 },
        physics: { total: 0, completed: 0 },
        chemistry: { total: 0, completed: 0 },
        arabic: { total: 0, completed: 0 },
        english: { total: 0, completed: 0 }
    };
    
    // مرور على جميع المهام وحساب التقدم
    for (let i = 1; i <= 60; i++) {
        const dayData = scheduleData.find(d => d.day === i) || { morning: 'غير محدد', evening: 'غير محدد' };
        const progressData = userProgress.tasks[i];
        
        if (dayData && progressData) {
            // حساب المهام الصباحية
            if (dayData.morning !== 'إجازة') {
                totalTasks++;
                if (progressData.morningCompleted) {
                    completedTasks++;
                }
                
                // تحديد المادة وإضافتها للحساب
                if (dayData.morning.includes('رياضيات')) {
                    subjects.math.total++;
                    if (progressData.morningCompleted) subjects.math.completed++;
                } else if (dayData.morning.includes('فيزياء')) {
                    subjects.physics.total++;
                    if (progressData.morningCompleted) subjects.physics.completed++;
                } else if (dayData.morning.includes('كيمياء')) {
                    subjects.chemistry.total++;
                    if (progressData.morningCompleted) subjects.chemistry.completed++;
                } else if (dayData.morning.includes('عربي')) {
                    subjects.arabic.total++;
                    if (progressData.morningCompleted) subjects.arabic.completed++;
                } else if (dayData.morning.includes('إنجليزي')) {
                    subjects.english.total++;
                    if (progressData.morningCompleted) subjects.english.completed++;
                }
            }
            
            // حساب المهام المسائية
            if (dayData.evening !== 'إجازة') {
                totalTasks++;
                if (progressData.eveningCompleted) {
                    completedTasks++;
                }
                
                // تحديد المادة وإضافتها للحساب
                if (dayData.evening.includes('رياضيات')) {
                    subjects.math.total++;
                    if (progressData.eveningCompleted) subjects.math.completed++;
                } else if (dayData.evening.includes('فيزياء')) {
                    subjects.physics.total++;
                    if (progressData.eveningCompleted) subjects.physics.completed++;
                } else if (dayData.evening.includes('كيمياء')) {
                    subjects.chemistry.total++;
                    if (progressData.eveningCompleted) subjects.chemistry.completed++;
                } else if (dayData.evening.includes('عربي')) {
                    subjects.arabic.total++;
                    if (progressData.eveningCompleted) subjects.arabic.completed++;
                } else if (dayData.evening.includes('إنجليزي')) {
                    subjects.english.total++;
                    if (progressData.eveningCompleted) subjects.english.completed++;
                }
            }
        }
    }
    
    // تحديث الإحصائيات في واجهة المستخدم
    const completionRate = totalTasks > 0 ? Math.round((completedTasks / totalTasks) * 100) : 0;
    document.getElementById('completionRate').textContent = completionRate + '%';
    document.getElementById('completedTasks').textContent = completedTasks;
    document.getElementById('streakDays').textContent = userProgress.streak;
    
    // تحديد المادة الأفضل
    let bestSubject = 'لا يوجد';
    let bestPercentage = 0;
    
    for (const [subject, data] of Object.entries(subjects)) {
        if (data.total > 0) {
            const percentage = Math.round((data.completed / data.total) * 100);
            if (percentage > bestPercentage) {
                bestPercentage = percentage;
                switch(subject) {
                    case 'math': bestSubject = 'رياضيات'; break;
                    case 'physics': bestSubject = 'فيزياء'; break;
                    case 'chemistry': bestSubject = 'كيمياء'; break;
                    case 'arabic': bestSubject = 'عربي'; break;
                    case 'english': bestSubject = 'إنجليزي'; break;
                }
            }
        }
    }
    
    document.getElementById('bestSubject').textContent = bestSubject;
}

// إعادة تعيين البرنامج
function resetProgram() {
    if (confirm('هل أنت متأكد من رغبتك في إعادة تعيين البرنامج؟ سيتم حذف جميع بياناتك!')) {
        localStorage.removeItem('studyScheduleProgress');
        location.reload();
    }
}

// تحديث أشرطة التقدم
function updateProgressBars() {
    // حساب التقدم العام
    let totalTasks = 0;
    let completedTasks = 0;
    
    // حساب التقدم لكل مادة
    let subjects = {
        math: { total: 0, completed: 0 },
        physics: { total: 0, completed: 0 },
        chemistry: { total: 0, completed: 0 },
        arabic: { total: 0, completed: 0 },
        english: { total: 0, completed: 0 }
    };
    
    // مرور على جميع المهام وحساب التقدم
    for (let i = 1; i <= 60; i++) {
        const dayData = scheduleData.find(d => d.day === i);
        const progressData = userProgress.tasks[i];
        
        if (dayData && progressData) {
            // حساب المهام الصباحية
            if (dayData.morning !== 'إجازة') {
                totalTasks++;
                if (progressData.morningCompleted) {
                    completedTasks++;
                }
                
                // تحديد المادة وإضافتها للحساب
                if (dayData.morning.includes('رياضيات')) {
                    subjects.math.total++;
                    if (progressData.morningCompleted) subjects.math.completed++;
                } else if (dayData.morning.includes('فيزياء')) {
                    subjects.physics.total++;
                    if (progressData.morningCompleted) subjects.physics.completed++;
                } else if (dayData.morning.includes('كيمياء')) {
                    subjects.chemistry.total++;
                    if (progressData.morningCompleted) subjects.chemistry.completed++;
                } else if (dayData.morning.includes('عربي')) {
                    subjects.arabic.total++;
                    if (progressData.morningCompleted) subjects.arabic.completed++;
                } else if (dayData.morning.includes('إنجليزي')) {
                    subjects.english.total++;
                    if (progressData.morningCompleted) subjects.english.completed++;
                }
            }
            
            // حساب المهام المسائية
            if (dayData.evening !== 'إجازة') {
                totalTasks++;
                if (progressData.eveningCompleted) {
                    completedTasks++;
                }
                
                // تحديد المادة وإضافتها للحساب
                if (dayData.evening.includes('رياضيات')) {
                    subjects.math.total++;
                    if (progressData.eveningCompleted) subjects.math.completed++;
                } else if (dayData.evening.includes('فيزياء')) {
                    subjects.physics.total++;
                    if (progressData.eveningCompleted) subjects.physics.completed++;
                } else if (dayData.evening.includes('كيمياء')) {
                    subjects.chemistry.total++;
                    if (progressData.eveningCompleted) subjects.chemistry.completed++;
                } else if (dayData.evening.includes('عربي')) {
                    subjects.arabic.total++;
                    if (progressData.eveningCompleted) subjects.arabic.completed++;
                } else if (dayData.evening.includes('إنجليزي')) {
                    subjects.english.total++;
                    if (progressData.eveningCompleted) subjects.english.completed++;
                }
            }
        }
    }
    
    // حساب النسب المئوية وتحديث أشرطة التقدم
    const totalPercentage = totalTasks > 0 ? Math.round((completedTasks / totalTasks) * 100) : 0;
    updateProgressBar('totalProgress', 'totalProgressText', totalPercentage);
    
    // تحديث تقدم كل مادة
    updateSubjectProgress(subjects.math, 'mathProgress', 'mathProgressText');
    updateSubjectProgress(subjects.physics, 'physicsProgress', 'physicsProgressText');
    updateSubjectProgress(subjects.chemistry, 'chemistryProgress', 'chemistryProgressText');
    updateSubjectProgress(subjects.arabic, 'arabicProgress', 'arabicProgressText');
    updateSubjectProgress(subjects.english, 'englishProgress', 'englishProgressText');
}

// تحديث شريط تقدم مادة معينة
function updateSubjectProgress(subject, barId, textId) {
    const percentage = subject.total > 0 ? Math.round((subject.completed / subject.total) * 100) : 0;
    updateProgressBar(barId, textId, percentage);
}

// تحديث شريط التقدم
function updateProgressBar(barId, textId, percentage) {
    const bar = document.getElementById(barId);
    const text = document.getElementById(textId);
    
    // تحديث عرض الشريط
    bar.style.width = percentage + '%';
    
    // تحديث النص
    text.textContent = percentage + '%';
}

</script>
